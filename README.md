# Eagle: Real-Time Football Tracking and Aggregation
## Introduction
Eagle converts football broadcast data from television feeds to tracking data useful for analysis and visualisation. It uses a collection of custom trained models and a variety of computer vision techniques to identify, track and obtain player and ball coordinates from each frame of broadcast data.

Unlike other solutions, Eagle is designed to work **directly on broadcast data** and does not require special scouting feeds or angles. It can read and process clips directly from matches.

**Note on this Fork:** This repository has been heavily modified to run as a **real-time, multi-threaded inference pipeline**. It consumes a live HLS stream with timed ID3 metadata, performs object tracking, and generates both a live annotated video (with minimap) and a per-second aggregated JSON file.

It now also supports **local file processing** and a **Web Interface** for easy deployment.

For more information on the original algorithm, refer to the [documentation](docs/algorithm.md).

---

## Installation (Linux / macOS)

### Prerequisites

1.  **Python 3.10+**: Ensure Python is installed.
2.  **FFmpeg**: Required for video processing.
    *   **Linux (Ubuntu/Debian):** `sudo apt install ffmpeg`
    *   **macOS:** `brew install ffmpeg`
3.  **Tmux**: Required for the deployment script `start.sh`.
    *   **Linux:** `sudo apt install tmux`
    *   **macOS:** `brew install tmux`

### Setup

1.  Clone the repository:
    ```bash
    git clone https://github.com/your-username/eagle.git
    cd eagle
    ```

2.  Install Python dependencies:
    Using `pip`:
    ```bash
    pip install -r requirements.txt
    ```
    Or using `uv`:
    ```bash
    uv pip install -r requirements.txt
    ```

3.  **Important:** The `start.sh` script will attempt to download the required model weights automatically. However, if you wish to download them manually, ensure they are placed in `eagle/models/weights/`.

---

## Quick Start: Web Interface

The easiest way to use Eagle is via the provided Web Interface, which handles video uploading, processing, and result retrieval.

1.  Run the startup script:
    ```bash
    ./start.sh
    ```
    This script will:
    *   Check for necessary weights (and download them if missing).
    *   Start a `tmux` session named `eagle`.
    *   Launch the FastAPI web server inside the session.

2.  Open your browser and navigate to:
    ```
    http://localhost:8000
    ```

3.  **Use the Interface:**
    *   **Upload Video:** Select a local video file (e.g., `.mp4`) and click "Process Video".
    *   **Stream URL:** Enter an HLS stream URL (e.g., `.m3u8`) and click "Process Stream".
    *   The system will process the video in the background. You can check the status and download the results (JSON Data and Annotated Video) once complete.

4.  **Stop the Server:**
    To stop the session, you can attach to tmux and kill it, or simply run:
    ```bash
    tmux kill-session -t eagle
    ```

---

## Advanced Usage: Command Line

You can also run the processing script manually without the web interface.

### Processing a Local File

To process a local video file without a GUI (headless mode):

```bash
python main.py --video_path "path/to/video.mp4" --output_dir "output" --headless
```

*   **Note:** For local files, the system generates synthetic timestamps starting from the current time, incrementing by 1 second for every second of video duration.

### Real-Time HLS Tracking (Original Demo)

This method requires a specific 3-terminal setup to simulate a "VOD-to-Live" pipeline with ID3 metadata.

#### Requirements
*   **An HLS VOD Stream Source:** This script is designed to run against the VOD stream generated by the [Org-id3 project](https://github.com/JacobJEdwards/Org-id3).

#### Steps

1.  **Terminal 1 - Host the VOD Stream (Org-id3)**
    ```bash
    cd /path/to/Org-id3/output_hls
    python3 -m http.server 8000
    ```

2.  **Terminal 2 - Start Eagle**
    ```bash
    cd /path/to/Eagle
    python main.py --video_path "live_stream/live.m3u8" --output_dir "output"
    ```
    *It will wait for the stream to start.*

3.  **Terminal 3 - Start FFmpeg Live Stream**
    ```bash
    cd /path/to/Eagle
    ffmpeg -re \
        -i http://localhost:8000/prog_index.m3u8 \
        -c copy \
        -map 0 \
        -f hls \
        -hls_time 1 \
        -hls_list_size 10 \
        -hls_flags delete_segments \
        live_stream/live.m3u8
    ```

4.  **Watch and Stop**
    *   Two windows will appear: **"Eagle Real-Time Tracking"** and **"Minimap"**.
    *   Press **'q'** to stop.

---

## Project Outputs

When processing finishes, you will find the following files in your specified output directory (or downloadable via the web UI):

1.  `annotated_demo_video.mp4`
    *   A video file of the annotated output.
    *   **Note:** The framerate of this video matches the model's processing speed (e.g., 8-10 FPS), ensuring annotations are synchronized.
2.  `aggregated_per_second_data.json`
    *   A JSON file containing the per-second aggregated data (Timestamp, Boundaries, Coordinates, etc.).

---

## Example Use Cases (from Original Eagle Framework)
The data generated by this pipeline can be used to create a variety of visualisations and metrics.

### Voronoi DiagramÂ 
Eagle can be used to create Voronoi diagrams of the pitch.

<table align="center">
 <tr>
  <td align="center" valign="middle"><img src="assets/mancity.gif" width="400" alt="Manchester City vs Nottingham Forest"/></td>
  <td align="center" valign="middle"><img src="assets/voronoi.png" width="400" alt="Voronoi Diagram"/></td>
 </tr>
</table>

### Pass Plot
Eagle can be used to create pass trajectories.

<table align="center">
 <tr>
  <td align="center" valign="middle"><img src="assets/lamine_yamal.gif" width="400" alt="Lamine Yamal assist 
during Euros"/></td>
  <td align="center" valign="middle"><img src="assets/pass.png" width="400" alt="Pass Trajectory Plot"/></td>
 </tr>
</table>

### Player Trajectory
Eagle can be used to visualize the movement of a player over time.

<table align="center">
 <tr>
  <td align="center" valign="middle"><img src="assets/messi.gif" width="400" alt="Lionel Messi goal vs Athletic Bilbao"/></td>
  <td align="center" valign="middle"><img src="assets/trajectory.png" width="400" alt="Player Trajectory 
Visualization"/></td>
 </tr>
</table>
